import{d as $,u as H,r as v,a as P,o as D,c as r,b as e,w as B,e as b,n as z,t as h,f as E,g as U,h as L,v as M,i as a}from"./index.js";const F={class:"min-h-full bg-gray-50 py-12"},J={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},O={class:"md:grid md:grid-cols-3 md:gap-6"},I={class:"mt-5 md:mt-0 md:col-span-2"},K={class:"shadow sm:rounded-md sm:overflow-hidden"},Q={class:"px-4 py-5 bg-white space-y-6 sm:p-6"},W={class:"flex"},X={class:"flex-shrink-0"},Y={key:0,class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},Z={key:1,class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},ee={class:"ml-3"},se={class:"space-y-4"},oe={class:"flex items-start space-x-6"},te={class:"h-24 w-24 rounded-lg bg-gray-100 border border-gray-200 overflow-hidden flex items-center justify-center"},le=["src"],re={key:1,class:"h-12 w-12 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ae={class:"flex-1"},ne={class:"flex items-center space-x-4"},ie={key:0,class:"mt-2 text-sm text-red-600"},de={key:1,class:"mt-2 text-sm text-green-600"},ue={key:2,class:"mt-2"},me=["disabled"],ce={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},pe={class:"mt-1"},ve={class:"mt-1"},fe={class:"px-4 py-3 bg-gray-50 text-right sm:px-6"},ge=["disabled"],xe={class:"mt-10 sm:mt-0"},we={class:"md:grid md:grid-cols-3 md:gap-6"},ye={class:"mt-5 md:mt-0 md:col-span-2"},be={class:"shadow sm:rounded-md sm:overflow-hidden"},he={class:"px-4 py-5 bg-white space-y-6 sm:p-6"},_e={class:"flex"},ke={class:"flex-shrink-0"},Le={key:0,class:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor"},Me={key:1,class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},je={class:"ml-3"},Ce={class:"mt-1"},ze={class:"mt-1"},Ee={class:"mt-1"},Ue={class:"px-4 py-3 bg-gray-50 text-right sm:px-6"},Ve=["disabled"],Be=$({__name:"ProfileView",setup(Ae){const f=H(),j=v(!1),C=v(!1),l=v(null),g=v(null),c=v(null),y=P({username:"",email:""}),n=P({old_password:"",new_password:"",confirm_password:""}),d=v(null),x=v(null),u=v(null),_=v(null),k=v(!1);D(()=>{f.user&&(y.username=f.user.username,y.email=f.user.email)});function S(m){const s=m.target;if(!s.files||s.files.length===0)return;const t=s.files[0];if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){u.value="Le format du fichier doit être JPG, JPEG ou PNG",d.value=null,x.value=null;return}const i=2*1024*1024;if(t.size>i){u.value="Le fichier est trop volumineux (maximum 2Mo)",d.value=null,x.value=null;return}const o=new Image;o.onload=()=>{URL.revokeObjectURL(o.src);const w=2e3;if(o.width>w||o.height>w){u.value=`L'image ne doit pas dépasser ${w}x${w} pixels`,d.value=null,x.value=null;return}u.value=null,d.value=t;const V=new FileReader;V.onload=R=>{var A;x.value=(A=R.target)==null?void 0:A.result},V.readAsDataURL(t)},o.onerror=()=>{u.value="Le fichier sélectionné n'est pas une image valide",d.value=null,x.value=null},o.src=URL.createObjectURL(t)}async function T(){var m,s,t,p;if(d.value){k.value=!0,u.value=null,_.value=null;try{await f.uploadLogo(d.value),_.value="Logo téléversé avec succès",d.value=null,setTimeout(()=>{_.value=null},3e3)}catch(i){(s=(m=i.response)==null?void 0:m.data)!=null&&s.error?u.value=i.response.data.error:(p=(t=i.response)==null?void 0:t.data)!=null&&p.detail?u.value=i.response.data.detail:u.value="Une erreur est survenue lors du téléversement du logo"}finally{k.value=!1}}}function N(){d.value=null,x.value=null}async function q(){var m;j.value=!0,l.value=null;try{await f.updateUserEmail(y.email);const s=l.value;l.value="Email mis à jour avec succès",setTimeout(()=>{l.value==="Email mis à jour avec succès"&&(l.value=null)},3e3)}catch(s){if((m=s.response)!=null&&m.data){const t=s.response.data;if(typeof t=="object"){const p=Object.entries(t).map(([i,o])=>{const w=Array.isArray(o)?o[0]:o;return`${i}: ${w}`}).join(`
`);l.value=p}else l.value=String(t)}else s.message?l.value=s.message:l.value="Une erreur est survenue lors de la mise à jour de l'email"}finally{j.value=!1}}async function G(){var m;if(n.new_password!==n.confirm_password){g.value="Les mots de passe ne correspondent pas",c.value=null;return}C.value=!0,g.value=null,c.value=null;try{await f.changePassword(n.old_password,n.new_password),n.old_password="",n.new_password="",n.confirm_password="",c.value="Mot de passe modifié avec succès",setTimeout(()=>{c.value==="Mot de passe modifié avec succès"&&(c.value=null)},3e3)}catch(s){if((m=s.response)!=null&&m.data){const t=s.response.data;if(typeof t=="object"){const p=Object.entries(t).map(([i,o])=>{const w=Array.isArray(o)?o[0]:o;return`${i}: ${w}`}).join(`
`);g.value=p}else g.value=String(t)}else s.message?g.value=s.message:g.value="Une erreur est survenue lors du changement de mot de passe"}finally{C.value=!1}}return(m,s)=>{var t,p,i;return a(),r("div",F,[e("div",J,[e("div",O,[s[16]||(s[16]=e("div",{class:"md:col-span-1"},[e("div",{class:"px-4 sm:px-0"},[e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Profil "),e("p",{class:"mt-1 text-sm text-gray-600"}," Ces informations seront affichées publiquement, soyez prudent avec ce que vous partagez. ")])],-1)),e("div",I,[e("form",{onSubmit:B(q,["prevent"])},[e("div",K,[e("div",Q,[l.value?(a(),r("div",{key:0,class:z(["rounded-md p-4",l.value==="Email mis à jour avec succès"?"bg-green-50":"bg-red-50"])},[e("div",W,[e("div",X,[l.value!=="Email mis à jour avec succès"?(a(),r("svg",Y,s[5]||(s[5]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)]))):(a(),r("svg",Z,s[6]||(s[6]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])))]),e("div",ee,[e("h3",{class:z(["text-sm font-medium",[l.value==="Email mis à jour avec succès"?"text-green-800":"text-red-800"]])},h(l.value),3)])])],2)):b("",!0),e("div",se,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium text-gray-700"}," Logo utilisateur ",-1)),e("div",oe,[e("div",null,[e("div",te,[x.value||(t=E(f).user)!=null&&t.logo?(a(),r("img",{key:0,src:x.value||((p=E(f).user)==null?void 0:p.logo)||"",class:"h-full w-full object-cover",alt:"Logo utilisateur"},null,8,le)):(a(),r("svg",re,s[7]||(s[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"},null,-1)])))])]),e("div",ae,[e("div",ne,[s[9]||(s[9]=e("label",{for:"logo-upload",class:"cursor-pointer inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[e("svg",{class:"-ml-1 mr-2 h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]),U(" Choisir un fichier ")],-1)),e("input",{id:"logo-upload",type:"file",class:"sr-only",accept:"image/*",onChange:S},null,32),d.value||(i=E(f).user)!=null&&i.logo?(a(),r("button",{key:0,type:"button",onClick:N,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},s[8]||(s[8]=[e("svg",{class:"-ml-1 mr-2 h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),U(" Supprimer ")]))):b("",!0)]),s[11]||(s[11]=e("p",{class:"mt-2 text-sm text-gray-500"}," PNG, JPG, JPEG jusqu'à 2Mo. Ce logo sera utilisé pour représenter votre entreprise. ",-1)),u.value?(a(),r("div",ie,h(u.value),1)):b("",!0),_.value?(a(),r("div",de,h(_.value),1)):b("",!0),d.value?(a(),r("div",ue,[e("button",{type:"button",onClick:T,disabled:k.value,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[k.value?(a(),r("svg",ce,s[10]||(s[10]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),U(" "+h(k.value?"Téléversement en cours...":"Téléverser le logo"),1)],8,me)])):b("",!0)])])]),e("div",null,[s[14]||(s[14]=e("label",{for:"username",class:"block text-sm font-medium text-gray-700"}," Nom d'utilisateur ",-1)),e("div",pe,[L(e("input",{type:"text",name:"username",id:"username","onUpdate:modelValue":s[0]||(s[0]=o=>y.username=o),disabled:"",class:"shadow-sm bg-gray-100 block w-full sm:text-sm border-gray-300 rounded-md cursor-not-allowed"},null,512),[[M,y.username]]),s[13]||(s[13]=e("p",{class:"mt-1 text-sm text-gray-500"},"Le nom d'utilisateur ne peut pas être modifié.",-1))])]),e("div",null,[s[15]||(s[15]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," Adresse e-mail ",-1)),e("div",ve,[L(e("input",{type:"email",name:"email",id:"email","onUpdate:modelValue":s[1]||(s[1]=o=>y.email=o),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md"},null,512),[[M,y.email]])])])]),e("div",fe,[e("button",{type:"submit",disabled:j.value,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},h(j.value?"Enregistrement...":"Enregistrer"),9,ge)])])],32)])]),s[23]||(s[23]=e("div",{class:"hidden sm:block","aria-hidden":"true"},[e("div",{class:"py-5"},[e("div",{class:"border-t border-gray-200"})])],-1)),e("div",xe,[e("div",we,[s[22]||(s[22]=e("div",{class:"md:col-span-1"},[e("div",{class:"px-4 sm:px-0"},[e("h3",{class:"text-lg font-medium leading-6 text-gray-900"}," Mot de passe "),e("p",{class:"mt-1 text-sm text-gray-600"}," Assurez-vous d'utiliser un mot de passe sécurisé. ")])],-1)),e("div",ye,[e("form",{onSubmit:B(G,["prevent"])},[e("div",be,[e("div",he,[g.value||c.value?(a(),r("div",{key:0,class:z(["rounded-md p-4",c.value?"bg-green-50":"bg-red-50"])},[e("div",_e,[e("div",ke,[c.value?(a(),r("svg",Le,s[17]||(s[17]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)]))):(a(),r("svg",Me,s[18]||(s[18]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)])))]),e("div",je,[e("h3",{class:z(["text-sm font-medium",[c.value?"text-green-800":"text-red-800"]])},h(c.value||g.value),3)])])],2)):b("",!0),e("div",null,[s[19]||(s[19]=e("label",{for:"current-password",class:"block text-sm font-medium text-gray-700"}," Mot de passe actuel ",-1)),e("div",Ce,[L(e("input",{type:"password",name:"current-password",id:"current-password","onUpdate:modelValue":s[2]||(s[2]=o=>n.old_password=o),required:"",class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md"},null,512),[[M,n.old_password]])])]),e("div",null,[s[20]||(s[20]=e("label",{for:"new-password",class:"block text-sm font-medium text-gray-700"}," Nouveau mot de passe ",-1)),e("div",ze,[L(e("input",{type:"password",name:"new-password",id:"new-password","onUpdate:modelValue":s[3]||(s[3]=o=>n.new_password=o),required:"",class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md"},null,512),[[M,n.new_password]])])]),e("div",null,[s[21]||(s[21]=e("label",{for:"confirm-password",class:"block text-sm font-medium text-gray-700"}," Confirmer le nouveau mot de passe ",-1)),e("div",Ee,[L(e("input",{type:"password",name:"confirm-password",id:"confirm-password","onUpdate:modelValue":s[4]||(s[4]=o=>n.confirm_password=o),required:"",class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md"},null,512),[[M,n.confirm_password]])])])]),e("div",Ue,[e("button",{type:"submit",disabled:C.value,class:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},h(C.value?"Modification...":"Modifier le mot de passe"),9,Ve)])])],32)])])])])])}}});export{Be as default};
